!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.template=b(a)}(this,function(){function e(a,b,c,d){var e,g,j,h="",i=C(c)?c:w(c);if(A(a)?g=v(a):C(a)&&(g=q(e.innerHTML||"")),g){if(j=f(g),!y(b))return j;h=j(b,d),i&&(i.innerHTML=h)}return h}function f(a){function c(a,c){a=y(a)?a:{data:a};try{return new b(a,c)+""}catch(d){throw d}}A(a)?a:"";var b=h(a);return c}function g(a,b){b=y(b)?b:{};var c=f(a);return c(b)}function h(a,d){function u(a){var f,h,j,m,o,g,b=a.split(d.tagStart),c=[],e=[];if(b.length>1){for(f=0;f<b.length;)g=b[f].split(d.tagEnd),g.length>1?(o=g[0],j="",m=n(g[1]),f+=1):(h=b[f+1].split(d.tagEnd),j=n(g[0]),m=n(h[1]),o=h[0],f+=2),c.push({startHtml:j,endHtml:m,code:o}),s(D(o),function(a){if(a&&!r[a]){var b;if(p(a))return!0;b=i[a]?"$helpers."+a:"$data."+a,l+=a+"="+b+",",r[a]=!0}});for(f=0;f<c.length;f++)c[f].code=k(c[f].code),e.push('_tpl.push("'+c[f].startHtml+'");'),e.push(c[f].code),e.push('_tpl.push("'+c[f].endHtml+'");')}else e=['_tpl.push("'+n(b[0])+'");'];return e.join("")}var f,h,l,q,r,t,e=y(d)?d:b;d={};for(f in b)d[f]=b[f],e.hasOwnProperty(f)&&(d[f]=e[f]);return d.tagStart=o(d.tagStart),d.tagEnd=o(d.tagEnd),new RegExp(d.tagStart+"(.*?)"+d.tagEnd,"g"),h="",l="var ",q="_tpl=[];",r={$data:1,$options:1,$utils:1,$helpers:1,_tpl:1,$print:1},h=m(),q+=u(a),q+='return new String(_tpl.join(""));',d.debug&&console&&console.log(h+l+q),t=new Function("$data","$options",(h+l+q).replace(/[\r\t\n]/g,"")),t.prototype.$taglibs=j,t.prototype.$helpers=i,t.prototype.$utils=c,t}function k(a,b){function e(a,b,c){var j,k,d=c.startReg||new RegExp("^\\s*"+b+"\\s*","i"),f=c.endReg||new RegExp("^\\/\\s*"+b+"\\s*|^\\s*"+b+"\\s*\\/","i"),g=c.startCheckReg||new RegExp("^\\s*"+b+"\\S+\\s*","i"),h=c.endCheckReg||new RegExp("^\\/\\s*"+b+"\\S+\\s*|^\\s*"+b+"\\S+\\s*\\/","i"),i=!1;if(c.startReg=d,c.endReg=f,c.startCheckReg=g,c.endCheckReg=h,f.test(a)&&!h.test(a))i=c.endCompile;else if(d.test(a)&&!g.test(a))i=c.startCompile;else if(c.subTags)for(j in c.subTags)if(k=e(a,j,c.subTags[j]))return k;return c.compile=i,i?c:i}var c,d;b=b||j,c=!1;for(d in b)if(c=e(a,d,b[d]))break;return c&&c.compile?(a=o(a,!0),a=c.compile(a)):a=l(a),a}function l(a){var b,c;if(a=q(a),/.+?\|\s*[\w_]+(\:.+)*/.test(a)){if(b=a.split(/\s*\|\s*|\s*\:\s*/),i[b[1]]){for(a=b[1]+"("+b[0],c=2;c<b.length;c++)a+=","+b[c];a+=")"}else a=b[0];a="_tpl.push("+n(a)+");"}else a="_tpl.push("+n(a)+");";return a}function m(){function b(c,d){var e,f,g;d=d||"";for(e in c){if(y(c[e].code)){f=c[e].code;for(g in f)"function"==typeof f[g]&&(a+=","+g+"="+d+'["'+e+'"]["code"]["'+g+'"]')}y(c[e].subTags)&&b(c[e].subTags,d+'["'+e+'"]["subTags"]')}}var a="var $taglibs=this.$taglibs,$helpers=this.$helpers";return b(j,"$taglibs"),a+=";"}function n(a){return a.replace(/"/g,'\\"')}function o(a,b){var f,g,c=[["<","&lt;"],[">","&gt;"],["&","&amp;"]],d=0,e=1;for(1==b&&(e=0,d=1),f=0;f<c.length;f++)g=new RegExp(c[f][d],"g"),a=a.replace(g,c[f][e]);return a}function p(a){function c(a,b){var e,d=!1;for(e in a){if(e==b){d=!0;break}if(y(a[e].subTags)&&(d=c(a[e].subTags,b)))break}return d}var b=c(j,a);return b}function q(a){return a.replace(/^\s+|\s+$/g,"")}function r(a){console?console.log(a):alert(a)}function s(a,b){var c,d;if(z(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}function t(a,b,c){function h(a,b,c){var d="",e=f(q(a));return c.url?u({url:c.url,async:!1,success:function(a){a=a.replace(/[\n\r\f\t\v]/g,"");var b=a;if(/^\s*[\[\{].*[\}\]]\s*$/.test(a))try{b=new Function("return "+a)(),b=z(b)?b:(b=b||{},B(b.data)?b:b.data)}catch(f){b={}}d=e(b,c)}}):y(b)&&(d=e(b,c)),d}function i(a,b,c){var d=w(a);if(d)d.innerHTML=b;else{if(c>200)return;setTimeout(function(){c+=1,i(a,b,c)},20)}}var e,g,d="";return c=y(c)?c:{},A(a)&&(e=v(a),e!==!1?d=h(e,b,c):(g="tpl_"+String(Math.random()).replace(".",""),d='<span id="'+g+'"></span>',u({url:a,success:function(f){e=v(a,f),d=h(e,b,c),i(g,d,0)}}))),d}function u(a){function c(a,b){if("json"==b&&/^\s*[\[\{].*[\}\]]\s*$/.test(a))try{a=new Function("return "+a)()}catch(c){a={data:a}}return a}var b;a=a||{},a.type=(a.type||"GET").toUpperCase(),a.dataType=(a.dataType||"text").toLowerCase(),a.async=a.async===!1?!1:!0,b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){if(4==b.readyState){var d=b.status;d>=200&&300>d?a.success&&a.success(c(b.responseText),d,b,a):a.error&&a.error(b,d,a),a.complete&&a.complete(b,b.responseText,a)}},/^get$/i.test(a.type)?(b.open("GET",a.url,a.async),b.send(null)):/^post$/i.test(a.type)&&(b.open("POST",a.url,a.async),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(null))}function v(a,c){var f,e=!1;return void 0!=c?(b["cache"]&&(d[a]=c),c):(b["cache"]?(e=d[a],void 0==e&&(e=!1,f=w(a),f&&(e=f.innerHTML,d[a]=e))):(f=w(a),f&&(e=f.innerHTML)),e)}function w(a){var b=null;return A(a)&&(b=document.getElementById(a)),b}function x(a){return Object.prototype.toString.call(a)}function y(a){return!!a&&"[object Object]"===x(a)}function z(a){return!!a&&"[object Array]"===x(a)}function A(a){return"[object String]"===x(a)}function B(a,b){return null===a||void 0===a||z(a)&&!a.length||(b?!1:""===a)}function C(a){var b="object"==typeof HTMLElement?function(a){return a instanceof HTMLElement}:function(a){return a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName};return b(a)}function D(a){return a.replace(F,"").replace(G,",").replace(H,"").replace(I,"").replace(J,"").split(K)}var i,j,E,F,G,H,I,J,K,a=function(a,b,c,d){return e(a,b,c,d)},b={tagStart:"{{",tagEnd:"}}",cache:!0,debug:!1},c={$el:w,each:s,trim:q,ajax:u,getTpl:v,include:t,print:r,isPlainObject:y,isArray:z,isString:A,isDOM:C},d={};return a.render=g,a.compile=f,a.config=function(a,c){var e,d={};y(a)||(d[a]=c);for(e in d)b.hasOwnProperty(e)&&(b[e]=d[e])},a.taglib=function(a,b){j[a]=b},a.helper=function(a,b){i[a]=b},a.utils=c,i={substr:function(a,b){a=String(a);var c=a.substr(0,b),d=a.length;return d>b&&(c+="..."),c}},j={print:{startCompile:function(a){var b=q(a).split(/\s+/);return a="$print("+b[1]+", "+b[2]+");"},endCompile:function(){return""},code:{$print:r}},"if":{startCompile:function(a){return a=q(a).replace(/if/i,"if("),a+="){"},endCompile:function(a){return a=a.replace(this.endReg,"}")},subTags:{elseif:{startCompile:function(a){return a=q(a).replace(/elseif/i,"}else if("),a+="){"}},"else":{startCompile:function(a){return a=q(a).replace(/else/i,"}else"),a+="{"}}}},each:{startCompile:function(a){var b=q(a).split(/\s+/);return a="$each("+b[1]+",function("+(b[3]||"$value")+", "+(b[4]||"$index")+"){"},endCompile:function(a){return a=a.replace(this.endReg,"});")},code:{$each:s}},include:{startCompile:function(a){var b=q(a).split(/\s+/),c=/url\s*=\s*(\S*)/.exec(a);return c=(c&&c[1]||"").replace(/'|"/g,""),a="_tpl.push($include("+b[1]+", "+b[2]+'||$data, {url:"'+c+'"}));'},endCompile:function(){return""},code:{$include:t}}},E="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",F=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,G=/[^\w$]+/g,H=new RegExp(["\\b"+E.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),I=/^\d[^,]*|,\d[^,]*/g,J=/^,+|,+$/g,K=/^$|,+/,a});